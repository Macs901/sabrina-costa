<!-- Analytics Integration - Dashboard Sabrina Costa -->
<!-- Google Analytics 4 + Hotjar + Custom Tracking -->
<!-- Incluir este arquivo em todas as páginas de documentação -->

<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX', {
    anonymize_ip: true,
    cookie_expires: 63072000,
    cookie_domain: 'auto',
    cookie_flags: 'SameSite=None;Secure'
  });
</script>

<!-- Hotjar -->
<script>
  (function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:YOUR_HOTJAR_ID,hjsv:6};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
  })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<!-- Custom Analytics -->
<script src="assets/js/analytics.js"></script>

<!-- Feedback Widget CSS -->
<style>
  /* Feedback Widget Styles */
  #feedback-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  .feedback-trigger {
    width: 50px;
    height: 50px;
    background: #007bff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    color: white;
    font-size: 20px;
  }
  
  .feedback-trigger:hover {
    background: #0056b3;
    transform: scale(1.1);
  }
  
  .feedback-panel {
    position: absolute;
    bottom: 60px;
    right: 0;
    width: 300px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    padding: 20px;
    border: 1px solid #e0e0e0;
  }
  
  .feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  
  .feedback-header h3 {
    margin: 0;
    font-size: 16px;
    color: #333;
  }
  
  .feedback-close {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #666;
  }
  
  .feedback-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .feedback-btn {
    flex: 1;
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .feedback-yes:hover {
    background: #d4edda;
    border-color: #28a745;
  }
  
  .feedback-no:hover {
    background: #f8d7da;
    border-color: #dc3545;
  }
  
  .feedback-more textarea {
    width: 100%;
    height: 80px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    resize: vertical;
    margin-bottom: 10px;
    font-family: inherit;
  }
  
  .feedback-submit {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
  }
  
  .feedback-thanks {
    text-align: center;
    color: #28a745;
    font-weight: bold;
  }
  
  @media (max-width: 768px) {
    .feedback-panel {
      width: 280px;
      right: -10px;
    }
  }
</style>

<!-- Search Analytics (Algolia DocSearch) -->
<script>
  // Track search events
  document.addEventListener('DOMContentLoaded', function() {
    // Track search box interactions
    const searchInputs = document.querySelectorAll('input[type="search"], .docsearch-input');
    searchInputs.forEach(input => {
      input.addEventListener('focus', function() {
        if (window.analytics) {
          window.analytics.trackEvent('search_focus', {
            category: 'Search',
            page: window.location.pathname
          });
        }
      });
      
      input.addEventListener('input', function() {
        if (window.analytics && this.value.length > 2) {
          window.analytics.trackEvent('search_typing', {
            search_term: this.value,
            category: 'Search',
            page: window.location.pathname
          });
        }
      });
    });
  });
</script>

<!-- Page Performance Tracking -->
<script>
  // Track page load performance
  window.addEventListener('load', function() {
    if (window.analytics) {
      const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
      window.analytics.trackEvent('page_load_time', {
        load_time: loadTime,
        page: window.location.pathname,
        category: 'Performance'
      });
    }
  });
</script>

<!-- Error Tracking -->
<script>
  // Track JavaScript errors
  window.addEventListener('error', function(e) {
    if (window.analytics) {
      window.analytics.trackEvent('javascript_error', {
        error_message: e.message,
        error_file: e.filename,
        error_line: e.lineno,
        page: window.location.pathname,
        category: 'Errors'
      });
    }
  });
</script>

<!-- Custom Events for Documentation -->
<script>
  // Track documentation-specific events
  document.addEventListener('DOMContentLoaded', function() {
    // Track code example clicks
    const codeBlocks = document.querySelectorAll('pre code, .highlight');
    codeBlocks.forEach(block => {
      block.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('code_click', {
            code_language: this.className.match(/language-(\w+)/) ? this.className.match(/language-(\w+)/)[1] : 'unknown',
            page: window.location.pathname,
            category: 'Engagement'
          });
        }
      });
    });
    
    // Track copy button clicks
    const copyButtons = document.querySelectorAll('[data-copy], .copy-btn');
    copyButtons.forEach(button => {
      button.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('code_copy', {
            page: window.location.pathname,
            category: 'Engagement'
          });
        }
      });
    });
    
    // Track external link clicks
    const externalLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + window.location.hostname + '"])');
    externalLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('external_link_click', {
            link_url: this.href,
            link_text: this.textContent.trim(),
            page: window.location.pathname,
            category: 'Navigation'
          });
        }
      });
    });
    
    // Track internal navigation
    const internalLinks = document.querySelectorAll('a[href^="/"], a[href^="./"], a[href^="../"]');
    internalLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('internal_link_click', {
            link_url: this.href,
            link_text: this.textContent.trim(),
            page: window.location.pathname,
            category: 'Navigation'
          });
        }
      });
    });
  });
</script>

<!-- Mermaid Diagram Tracking -->
<script>
  // Track Mermaid diagram interactions
  document.addEventListener('DOMContentLoaded', function() {
    const mermaidDiagrams = document.querySelectorAll('.mermaid, [data-mermaid]');
    mermaidDiagrams.forEach(diagram => {
      diagram.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('diagram_click', {
            diagram_type: 'mermaid',
            page: window.location.pathname,
            category: 'Engagement'
          });
        }
      });
    });
  });
</script>

<!-- API Playground Tracking -->
<script>
  // Track API Playground interactions
  document.addEventListener('DOMContentLoaded', function() {
    // Track Swagger UI interactions
    const swaggerElements = document.querySelectorAll('.swagger-ui, [data-swagger]');
    swaggerElements.forEach(element => {
      element.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('api_playground_interaction', {
            interaction_type: 'click',
            page: window.location.pathname,
            category: 'API_Playground'
          });
        }
      });
    });
    
    // Track "Try it out" button clicks
    const tryButtons = document.querySelectorAll('.btn.try-out__btn, [data-try-out]');
    tryButtons.forEach(button => {
      button.addEventListener('click', function() {
        if (window.analytics) {
          window.analytics.trackEvent('api_try_out', {
            endpoint: this.dataset.endpoint || 'unknown',
            page: window.location.pathname,
            category: 'API_Playground'
          });
        }
      });
    });
  });
</script>

<!-- Tutorial Progress Tracking -->
<script>
  // Track tutorial progress
  document.addEventListener('DOMContentLoaded', function() {
    const tutorialSteps = document.querySelectorAll('[data-tutorial-step]');
    const progressBar = document.querySelector('.tutorial-progress');
    
    if (tutorialSteps.length > 0) {
      // Track tutorial start
      if (window.analytics) {
        window.analytics.trackEvent('tutorial_start', {
          tutorial_name: document.title,
          page: window.location.pathname,
          category: 'Tutorials'
        });
      }
      
      // Track step completion
      tutorialSteps.forEach((step, index) => {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              if (window.analytics) {
                window.analytics.trackEvent('tutorial_step_view', {
                  step_number: index + 1,
                  step_name: step.dataset.tutorialStep || `Step ${index + 1}`,
                  tutorial_name: document.title,
                  page: window.location.pathname,
                  category: 'Tutorials'
                });
              }
            }
          });
        });
        
        observer.observe(step);
      });
    }
  });
</script>

<!-- Mobile Responsiveness Tracking -->
<script>
  // Track mobile usage
  document.addEventListener('DOMContentLoaded', function() {
    const isMobile = window.innerWidth <= 768;
    const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
    
    if (window.analytics) {
      window.analytics.trackEvent('device_type', {
        device_type: isMobile ? 'mobile' : isTablet ? 'tablet' : 'desktop',
        screen_width: window.innerWidth,
        screen_height: window.innerHeight,
        page: window.location.pathname,
        category: 'Device'
      });
    }
  });
</script>

<!-- Print Tracking -->
<script>
  // Track print events
  window.addEventListener('beforeprint', function() {
    if (window.analytics) {
      window.analytics.trackEvent('page_print', {
        page: window.location.pathname,
        category: 'Engagement'
      });
    }
  });
</script>

<!-- Download Tracking -->
<script>
  // Track file downloads
  document.addEventListener('DOMContentLoaded', function() {
    const downloadLinks = document.querySelectorAll('a[href$=".pdf"], a[href$=".doc"], a[href$=".docx"], a[href$=".zip"], a[href$=".rar"]');
    downloadLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.analytics) {
          const fileName = this.href.split('/').pop();
          const fileType = fileName.split('.').pop();
          
          window.analytics.trackEvent('file_download', {
            file_name: fileName,
            file_type: fileType,
            page: window.location.pathname,
            category: 'Downloads'
          });
        }
      });
    });
  });
</script>
